# 多群组并行压测使用指南

## 📝 概述

已成功为项目添加多群组并行压测功能，可以同时对多个 FISCO BCOS 群组执行压测。

## ✅ 完成情况

- ✅ 新增 `PerformanceMultiGroupDMC` 压测类
- ✅ 代码已编译并打包成功
- ✅ 提供详细使用文档
- ✅ 提供便捷启动脚本
- ✅ 更新项目 README

## 🚀 快速使用

### 第一步：编译项目

```bash
# 在项目根目录执行
bash gradlew build
```

### 第二步：配置 SDK

```bash
# 拷贝 FISCO BCOS 节点的 SDK 证书
cp -r ~/fisco/nodes/127.0.0.1/sdk/* conf/

# 拷贝配置文件模板
cp src/test/resources/config-example.toml conf/config.toml

# 编辑 conf/config.toml，修改节点地址
# 例如：peers=["127.0.0.1:20200", "127.0.0.1:20201"]
```

### 第三步：执行压测

#### 方法一：使用脚本（推荐）

```bash
# 使用默认参数（3个群组，每群组8个账户，10000笔交易，QPS=100）
./multi_group_test.sh

# 自定义参数
./multi_group_test.sh "group0,group1" 16 20000 200
```

#### 方法二：直接运行 Java 命令

```bash
cd dist

# 对三个群组同时压测
java -cp 'conf/:lib/*:apps/*' \
    org.fisco.bcos.sdk.demo.perf.PerformanceMultiGroupDMC \
    group0,group1,group2 8 10000 100
```

## 📊 参数说明

```bash
java ... PerformanceMultiGroupDMC [群组列表] [账户数] [交易数] [QPS]
```

| 参数 | 说明 | 推荐值 |
|------|------|--------|
| 群组列表 | 用逗号分隔，如 `group0,group1,group2` | 3个群组 |
| 账户数 | 每个群组创建的账户数量 | 8-16 |
| 交易数 | 每个群组的交易总数 | 10000 |
| QPS | 每个群组的每秒请求数 | 100 |

## 📈 输出示例

```
====== Multi-Group DMC Performance Test ======
Groups: group0,group1,group2
User count per group: 8
Transactions per group: 10000
Total groups: 3
Total transactions: 30000
================================================

[Group 0: group0] Starting test...
[Group 1: group1] Starting test...
[Group 2: group2] Starting test...

... 执行过程 ...

====================================================================
==================== Multi-Group Test Summary =====================
====================================================================
Total groups tested: 3
Total transactions: 30000
Total time: 106789ms
Overall TPS: 280.93
====================================================================
```

## 🔍 功能特点

1. **并行执行**：多个群组同时压测，充分利用系统资源
2. **独立统计**：每个群组有独立的性能报告
3. **实时进度**：使用进度条显示发送和接收进度
4. **总体汇总**：提供所有群组的总体性能统计

## 📂 相关文件

- **核心代码**: `src/main/java/org/fisco/bcos/sdk/demo/perf/PerformanceMultiGroupDMC.java`
- **快速指南**: `MULTI_GROUP_USAGE.md`
- **详细文档**: `docs/MultiGroupPerformanceTest.md`
- **启动脚本**: `multi_group_test.sh`
- **项目状态**: `PROJECT_STATUS.md`

## 🎯 在 Ubuntu 上测试

### 1. 上传项目

```bash
# 在本地执行
scp -r java-sdk-demo user@ubuntu-server:/home/user/
```

### 2. 在 Ubuntu 上编译

```bash
# SSH 登录到 Ubuntu
ssh user@ubuntu-server

# 进入项目目录
cd /home/user/java-sdk-demo

# 编译项目
bash gradlew build
```

### 3. 配置和运行

```bash
# 配置 SDK（根据实际节点地址修改）
cp -r /path/to/fisco/nodes/127.0.0.1/sdk/* conf/
cp src/test/resources/config-example.toml conf/config.toml
vim conf/config.toml  # 修改节点地址

# 执行压测
./multi_group_test.sh
```

## ⚙️ 性能调优

### 系统配置

```bash
# 增加文件描述符限制
ulimit -n 65535
```

### JVM 参数（大规模压测）

```bash
java -Xmx4g -Xms4g -XX:+UseG1GC \
    -cp 'conf/:lib/*:apps/*' \
    org.fisco.bcos.sdk.demo.perf.PerformanceMultiGroupDMC \
    group0,group1,group2 8 10000 100
```

## ❓ 常见问题

**Q1: 如何确定最佳参数？**  
A: 从小参数开始（QPS=50, count=1000），逐步增加直到达到性能瓶颈。

**Q2: 可以对同一个群组压测多次吗？**  
A: 可以，但建议一次压测完成后再进行下一次，不要在参数中重复群组ID。

**Q3: 某个群组失败了怎么办？**  
A: 各群组独立执行，单个失败不影响其他群组。检查失败群组的错误信息和日志。

**Q4: 总体 TPS 能否达到单群组的 N 倍？**  
A: 理论上可以，实际取决于节点处理能力、网络带宽和系统资源。

## 📞 技术支持

- 详细文档：查看 `docs/MultiGroupPerformanceTest.md`
- 变更说明：查看 `CHANGES.md`
- 项目状态：查看 `PROJECT_STATUS.md`

## ✨ 下一步

1. 在 Ubuntu 环境部署 FISCO BCOS 多群组节点
2. 配置节点连接和证书
3. 执行小规模测试验证功能
4. 逐步增加负载进行性能测试
5. 分析结果并调优参数

---

**祝测试顺利！** 🎉
