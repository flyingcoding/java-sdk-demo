# 🎬 并行转账压测 - 使用演示

## 🎯 改进前后对比

### ❌ 改进前（需要2条命令）

```bash
# 第1步：添加用户（需要指定文件名）
cd dist
java -cp 'conf/:lib/*:apps/*' org.fisco.bcos.sdk.demo.perf.ParallelOkPerf \
  parallelok 1 add 1000 100 user.txt

# 等待执行完成...（需要手动等待）

# 第2步：执行转账（需要记住文件名）
java -cp 'conf/:lib/*:apps/*' org.fisco.bcos.sdk.demo.perf.ParallelOkPerf \
  parallelok 1 transfer 10000 100 user.txt
```

**问题：**
- 🔴 需要2条命令
- 🔴 需要记住文件名
- 🔴 需要手动等待
- 🔴 命令太长，容易出错

---

### ✅ 改进后（只需1条命令）

#### 方式1：超级快速（零配置）

```bash
cd dist
./quick-perf.sh
```

**就这么简单！** 按回车后自动完成：
- ✅ 生成500个用户
- ✅ 执行5000笔转账
- ✅ 自动验证结果

#### 方式2：自定义参数

```bash
cd dist
./auto-perf.sh 1 1000 10000 100
```

参数说明：`[群组ID] [用户数] [交易数] [TPS]`

---

## 📺 实际运行效果

### 演示1：快速模式

```bash
$ cd dist
$ ./quick-perf.sh
```

**输出效果：**
```
╔════════════════════════════════════════════════════════════════╗
║          FISCO BCOS 并行转账快速压测工具                      ║
╚════════════════════════════════════════════════════════════════╝

📊 压测配置:
   群组ID        : 1
   用户数量      : 500
   转账交易数    : 5000
   目标TPS       : 100

⏳ [1/4] 部署并行合约...
✅ 合约部署成功: 0x8f0483d...

⏳ [2/4] 生成 500 个用户并添加到合约...
   进度: 500/500
✅ 用户添加完成，共 500 个

⏳ [3/4] 查询账户余额...
✅ 账户查询完成

⏳ [4/4] 执行 5000 笔转账...
   进度: 5000/5000
✅ 转账完成

⏳ 验证结果...
   验证结果: 成功 500, 失败 0

╔════════════════════════════════════════════════════════════════╗
║                    ✅ 压测成功完成！                          ║
╚════════════════════════════════════════════════════════════════╝
```

**用时：约30-60秒**

---

### 演示2：自定义参数

```bash
$ cd dist
$ ./auto-perf.sh 1 1000 10000 100
```

**输出效果：**
```
====================================================================
========== 自动化并行转账压测开始 ==========
====================================================================
配置信息:
  群组ID        : 1
  用户数量      : 1000
  转账交易总数  : 10000
  目标TPS       : 100
====================================================================

【步骤 1/4】部署并行转账合约...
  ✓ 合约部署成功
  ✓ 合约地址: 0x1234567890abcdef1234567890abcdef12345678

【步骤 2/4】自动生成用户并添加到合约...
  生成 1000 个用户，初始余额: 1000000000
  已发送: 100/1000 笔添加用户交易，发送速度=98.50 TPS
  已发送: 200/1000 笔添加用户交易，发送速度=99.20 TPS
  已发送: 300/1000 笔添加用户交易，发送速度=99.80 TPS
  已发送: 400/1000 笔添加用户交易，发送速度=100.10 TPS
  已发送: 500/1000 笔添加用户交易，发送速度=99.90 TPS
  已发送: 600/1000 笔添加用户交易，发送速度=100.00 TPS
  已发送: 700/1000 笔添加用户交易，发送速度=99.85 TPS
  已发送: 800/1000 笔添加用户交易，发送速度=100.05 TPS
  已发送: 900/1000 笔添加用户交易，发送速度=99.95 TPS
  已发送: 1000/1000 笔添加用户交易，发送速度=100.00 TPS
  ✓ 用户添加完成，共 1000 个用户

【步骤 3/4】查询账户信息...
  已查询: 100/1000 个账户
  已查询: 200/1000 个账户
  ...
  已查询: 1000/1000 个账户
  ✓ 账户信息查询完成

【步骤 4/4】执行转账压测...
  发送 10000 笔转账交易，目标TPS: 100
  已发送: 1000/10000 笔转账交易，发送速度=99.80 TPS
  已发送: 2000/10000 笔转账交易，发送速度=100.20 TPS
  已发送: 3000/10000 笔转账交易，发送速度=99.95 TPS
  已发送: 4000/10000 笔转账交易，发送速度=100.05 TPS
  已发送: 5000/10000 笔转账交易，发送速度=100.00 TPS
  已发送: 6000/10000 笔转账交易，发送速度=99.98 TPS
  已发送: 7000/10000 笔转账交易，发送速度=100.02 TPS
  已发送: 8000/10000 笔转账交易，发送速度=100.01 TPS
  已发送: 9000/10000 笔转账交易，发送速度=99.99 TPS
  已发送: 10000/10000 笔转账交易，发送速度=100.00 TPS
  ✓ 转账交易全部完成

【验证】验证转账结果...
  验证完成:
    总用户数    : 1000
    验证成功    : 1000
    验证失败    : 0
  ✓ 所有账户余额验证通过！

====================================================================
========== 自动化并行转账压测完成 ==========
====================================================================
```

**用时：约2-3分钟**

---

## 💡 不同场景的使用方法

### 场景1：刚接手项目，想快速验证

```bash
cd dist
./quick-perf.sh
```

✅ 无需任何参数  
✅ 30秒搞定  
✅ 验证环境配置

---

### 场景2：需要定制化压测

```bash
cd dist

# 小规模测试
./quick-perf.sh 1 100 500 50

# 中等规模测试
./quick-perf.sh 1 1000 10000 100

# 大规模测试
./auto-perf.sh 1 5000 50000 500
```

✅ 灵活调整参数  
✅ 适应不同需求

---

### 场景3：性能调优

```bash
cd dist

# 步骤1：从小参数开始
./quick-perf.sh 1 100 1000 50

# 步骤2：逐步增加TPS
./quick-perf.sh 1 100 1000 100
./quick-perf.sh 1 100 1000 200
./quick-perf.sh 1 100 1000 500

# 步骤3：找到最佳TPS阈值
./auto-perf.sh 1 1000 10000 [最佳TPS]
```

✅ 系统化调优  
✅ 找到性能瓶颈

---

## 🎓 从零开始的完整示例

假设你是第一次使用这个项目：

### 第1步：确保节点运行

```bash
# 检查FISCO BCOS节点是否运行
# 这里假设你已经有了运行的节点
```

### 第2步：配置连接

```bash
# 进入项目目录
cd /Users/flying/Desktop/java/java-sdk-demo

# 拷贝证书（假设节点在 ~/fisco/nodes/127.0.0.1/）
cp -r ~/fisco/nodes/127.0.0.1/sdk/* dist/conf/

# 创建配置文件
cp dist/conf/config-example.toml dist/conf/config.toml

# 如果节点地址不是默认的，编辑配置文件
# vi dist/conf/config.toml
# 修改 [network] 部分的 peers
```

### 第3步：运行压测

```bash
# 进入dist目录
cd dist

# 运行快速压测
./quick-perf.sh
```

### 第4步：查看结果

压测完成后，你会看到：
- ✅ 部署的合约地址
- ✅ 生成的用户数量
- ✅ 执行的交易数量
- ✅ 实际TPS
- ✅ 验证结果

---

## 🆚 三种工具对比

| 工具 | 命令 | 参数 | 适用场景 |
|------|------|------|----------|
| **QuickParallelPerf** | `./quick-perf.sh` | 0-4个（可选） | 🌟 快速验证 |
| **AutoParallelOkPerf** | `./auto-perf.sh [4个参数]` | 必须4个 | 📊 详细压测 |
| **ParallelOkPerf** | `java -cp ... [6个参数]` | 必须6个，分2次 | 💾 需要保存用户 |

---

## 🎉 总结

使用新工具，你可以：

✅ **3秒上手** - 零学习成本  
✅ **1条命令** - 从2条减少到1条  
✅ **自动完成** - 无需手动管理文件  
✅ **实时反馈** - 清晰的进度显示  
✅ **自动验证** - 确保结果正确  

**开始你的压测之旅吧！** 🚀

---

**快速参考：**
- 📚 完整文档：[并行压测使用说明.md](并行压测使用说明.md)
- 🚀 快速入门：[一键压测快速入门.md](一键压测快速入门.md)
- 📝 改进说明：[项目改进说明.md](项目改进说明.md)

