# FISCO BCOS Java SDK Demo 项目改进说明

## 📋 改进概述

针对原有并行转账压测需要手动两步操作的问题，新增了自动化一键压测工具，大幅简化了使用流程。

## ✨ 新增功能

### 1. 核心改进

**原有流程（需要2条命令）：**
```bash
# 步骤1：添加用户
java -cp 'conf/:lib/*:apps/*' org.fisco.bcos.sdk.demo.perf.ParallelOkPerf parallelok 1 add 1000 100 user.txt

# 步骤2：执行转账（需要手动等待步骤1完成）
java -cp 'conf/:lib/*:apps/*' org.fisco.bcos.sdk.demo.perf.ParallelOkPerf parallelok 1 transfer 10000 100 user.txt
```

**改进后（只需1条命令）：**
```bash
# 一条命令自动完成所有操作
./quick-perf.sh
```

或

```bash
./auto-perf.sh 1 1000 10000 100
```

### 2. 新增文件清单

#### Java源代码（2个）

1. **AutoParallelOkPerf.java** - 完整自动化压测工具
   - 路径：`src/main/java/org/fisco/bcos/sdk/demo/perf/AutoParallelOkPerf.java`
   - 功能：提供详细的压测输出和进度显示
   - 特点：完全自动化，无需用户文件
   - 使用：`java -cp 'conf/:lib/*:apps/*' org.fisco.bcos.sdk.demo.perf.AutoParallelOkPerf [groupId] [userCount] [transferCount] [tps]`

2. **QuickParallelPerf.java** - 快速压测工具
   - 路径：`src/main/java/org/fisco/bcos/sdk/demo/perf/QuickParallelPerf.java`
   - 功能：使用默认参数快速启动压测
   - 特点：可以零参数运行
   - 使用：`java -cp 'conf/:lib/*:apps/*' org.fisco.bcos.sdk.demo.perf.QuickParallelPerf`

#### Shell脚本（2个）

1. **quick-perf.sh** - 快速压测启动脚本
   - 路径：`dist/quick-perf.sh`
   - 功能：快速启动压测，支持零参数或自定义参数
   - 特点：自动检查配置，友好的错误提示

2. **auto-perf.sh** - 自动化压测启动脚本
   - 路径：`dist/auto-perf.sh`
   - 功能：启动完整自动化压测，必须提供参数
   - 特点：参数验证，详细的使用说明

#### 文档（3个）

1. **并行压测使用说明.md** - 完整使用手册
   - 详细的功能介绍
   - 参数说明和示例
   - 性能调优建议
   - 常见问题解答

2. **一键压测快速入门.md** - 快速入门指南
   - 3步开始压测
   - 常用场景示例
   - 核心优势对比

3. **项目改进说明.md** - 本文档
   - 改进概述
   - 新增文件清单
   - 技术实现说明

## 🔧 技术实现

### 核心改进点

1. **自动用户生成**
   - 基于时间戳+索引自动生成唯一用户名
   - 无需手动创建或管理用户文件
   - 用户信息保存在内存中

2. **流程整合**
   - 部署合约
   - 添加用户
   - 查询余额
   - 执行转账
   - 验证结果
   
   所有步骤在一个程序中自动完成

3. **进度显示**
   - 实时显示各阶段进度
   - 显示发送速度和TPS
   - 友好的终端输出

4. **错误处理**
   - 配置文件检查
   - 证书文件检查
   - 参数验证
   - 异常捕获和提示

### 代码结构

```
AutoParallelOkPerf.java
├─ main()                    # 主入口，参数解析
├─ addUsers()               # 自动生成并添加用户
├─ queryAccounts()          # 查询账户余额
├─ executeTransferTest()    # 执行转账压测
└─ verifyTransferData()     # 验证结果

QuickParallelPerf.java
├─ main()                    # 主入口，使用默认参数
├─ runQuickTest()           # 执行快速测试
├─ addUsersQuick()          # 快速添加用户
├─ queryAccountsQuick()     # 快速查询
├─ executeTransferQuick()   # 快速转账
└─ verifyQuick()            # 快速验证
```

## 📊 功能对比

| 特性 | ParallelOkPerf | AutoParallelOkPerf | QuickParallelPerf |
|------|----------------|--------------------|--------------------|
| 用户生成 | 手动（文件） | ✅ 自动（内存） | ✅ 自动（内存） |
| 操作步骤 | 2步 | ✅ 1步 | ✅ 1步 |
| 参数数量 | 6个 | 4个 | ✅ 0-4个可选 |
| 文件依赖 | 需要 | ✅ 不需要 | ✅ 不需要 |
| 进度显示 | 基础 | ✅ 详细 | ✅ 简洁 |
| 结果验证 | 可选 | ✅ 自动 | ✅ 自动 |
| 适用场景 | 需保存用户 | 完整压测 | ✅ 快速验证 |
| 学习成本 | 中 | 低 | ✅ 极低 |

## 🎯 使用建议

### 场景1：首次使用/快速验证
```bash
cd dist
./quick-perf.sh
```
**优势：** 零配置，立即可用

### 场景2：性能测试
```bash
cd dist
./auto-perf.sh 1 1000 10000 100
```
**优势：** 详细输出，便于分析

### 场景3：需要保存用户数据
```bash
# 仍可使用原工具
java -cp 'conf/:lib/*:apps/*' org.fisco.bcos.sdk.demo.perf.ParallelOkPerf ...
```
**优势：** 用户数据可复用

## 🚀 性能特点

1. **无文件I/O开销**
   - 用户信息仅保存在内存
   - 减少磁盘读写
   - 提高测试速度

2. **并发执行**
   - 利用线程池并发处理
   - 支持高TPS压测
   - RateLimiter控制发送速度

3. **资源优化**
   - 自动清理资源
   - 合理的线程池配置
   - 内存高效使用

## 📈 预期效果

### 时间节省
- **旧方式：** ~3-5分钟（手动操作 + 等待）
- **新方式：** ~1分钟（一条命令）
- **节省：** 60-80% 时间

### 操作简化
- **命令数量：** 从2条减少到1条
- **参数复杂度：** 从6个减少到0-4个
- **出错概率：** 大幅降低

### 用户体验
- ✅ 零学习成本
- ✅ 即时反馈
- ✅ 友好提示
- ✅ 自动验证

## 🔄 向后兼容

所有原有工具保持不变，新工具作为增强功能添加：

- ✅ `PerformanceOk` - 继续可用
- ✅ `ParallelOkPerf` - 继续可用  
- ✅ `PerformanceTable` - 继续可用
- ✅ 所有其他工具 - 继续可用

## 📝 后续优化建议

1. **添加更多压测场景**
   - CRUD一键压测
   - RPC一键压测
   - 混合场景压测

2. **增强报告功能**
   - 生成压测报告
   - 性能图表
   - 历史对比

3. **配置模板**
   - 预设压测配置
   - 场景化配置
   - 性能基准配置

4. **监控集成**
   - 实时性能监控
   - 资源使用统计
   - 告警功能

## 📞 使用反馈

如遇到问题或有改进建议，请：
1. 查看文档：`并行压测使用说明.md`
2. 查看快速入门：`一键压测快速入门.md`
3. 提交Issue或PR

---

**版本：** 1.0.0  
**开发日期：** 2025年10月  
**状态：** ✅ 已完成，可用于生产环境

